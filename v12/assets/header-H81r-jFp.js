import{k as A,e as O,M as h,d,a as g,l as I,s as N,m as q,_ as k,r as z,o as V}from"./main-4mJBKzgy.js";import{j as e}from"./vendor-gzd0YkcT.js";import{a as w,d as f}from"./firebase-DcuqlnV9.js";import{o as B,s as T,a as b,b as R,e as E,g as W,q as F,c as Q,w as X,f as Y,u as Z,h as G,i as H,j as J,k as K}from"./firebase-Biq5-BBI.js";const p={db:"smiles",rol:"smile"},C={"auth/email-already-in-use":"Email ya registrado","auth/weak-password":"Contraseña débil","auth/invalid-credential":"Contraseña incorrecta","auth/invalid-email":"Email no válido","auth/missing-email":"Usuario no registrado","auth/too-many-requests":"Demasiados intentos, espera"},P={regEmail:[a=>a.toLowerCase().trim(),a=>/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/.test(a)||"Email inválido"],regUsuario:[a=>a.toLowerCase().replace(/[^a-z0-9_]/g,"").trim(),a=>a.length>=4||"Usuario 4-20 caracteres"],regNombre:[a=>a.trim(),a=>a.length>0||"Ingrese nombre"],regApellidos:[a=>a.trim(),a=>a.length>0||"Ingrese apellidos"],regPassword:[a=>a,a=>a.length>=6||"Mínimo 6 caracteres"],regPassword1:[a=>a,a=>a===e("#regPassword").val()||"No coinciden"]},c=(a,o,r,n,s)=>`<div class="au_grupo"><i class="fas fa-${a}"></i><input type="${o}" id="${r}" placeholder="${n}" required>${s?'<i class="fas fa-eye au_ojo"></i>':""}</div>`,_=(a,o,r,n="")=>`<div id="${a}" class="wiModal au_mod ${n}"><div class="modalBody"><button class="modalX">&times;</button><div class="au_main"><div class="au_logo">
   <img src="./smile.avif"></div><h2>${o}</h2><form id="${a.replace("Modal","Form")}">${r}</form></div></div></div>`,aa=[_("loginModal","Login",[c("envelope","text","email","Email o usuario"),c("lock","password","password","Contraseña",!0),'<button type="button" id="Login" class="au_btn inactivo">Iniciar Sesión</button>','<div class="au_links"><span class="olvidastePass">¿Olvidaste tu contraseña?</span><span class="crearCuenta">Crear cuenta</span></div>'].join("")),_("registroModal","Crear Cuenta",[c("envelope","email","regEmail","Email"),c("user","text","regUsuario","Usuario"),c("user-tie","text","regNombre","Nombre"),c("user-tie","text","regApellidos","Apellidos"),c("lock","password","regPassword","Contraseña",!0),c("lock","password","regPassword1","Confirmar",!0),'<div class="au_grupo au_check"><label><input type="checkbox" id="regTerminos" required><span>Acepto los <a href="/terminos.html" target="_blank">términos y condiciones</a></span></label></div>','<button type="button" id="Registrar" class="au_btn inactivo">Registrarme</button>','<div class="au_links"><span class="conCuenta">Ya tengo cuenta</span></div>'].join(""),"au_reg"),_("recuperarModal","Restablecer",["<p>Ingresa tu Email o usuario:</p>",c("envelope","text","recEmail","Email o usuario"),'<button type="button" id="Recuperar" class="au_btn inactivo">Enviar enlace</button>','<div class="au_links"><span class="volverLogin"><i class="fas fa-arrow-left"></i> Volver</span></div>'].join(""))];let $=!1;const ea=()=>{$||(e("body").append(aa.join("")),$=!0,ta())},M=async a=>{if(a.includes("@"))return a;const o=await E(b(f,p.db,a));if(!o.exists())throw new Error("Usuario no encontrado");return o.data().email},sa=a=>{if(!a)return;const[o,r]=a.split("|");document.documentElement.dataset.theme=o,e('meta[name="theme-color"]').attr("content",r),e(".tema").removeClass("mtha").filter(`[data-ths="${a}"]`).addClass("mtha")},S=async(a,o=24)=>{N("wiSmile",a,o),q(),(await k(async()=>{const{personal:r}=await Promise.resolve().then(()=>ia);return{personal:r}},void 0)).personal(a)},u=a=>e(`#${a}`).val().trim(),ta=()=>{let a=!1,o=!1,r=!1;e(document).on("click.wa",".au_ojo",function(){const s=e(this).siblings("input");s.attr("type",s.attr("type")==="password"?"text":"password"),e(this).toggleClass("fa-eye fa-eye-slash")}),e(document).on("input.wa","#regUsuario,#regEmail,#email,#recEmail",function(){e(this).val(e(this).val().toLowerCase())}),[["#password","#Login"],["#regPassword1","#Registrar"],["#recEmail","#Recuperar"]].forEach(([s,t])=>e(document).on("input.wa keyup.wa",s,i=>{e(t).removeClass("inactivo"),i.key==="Enter"&&e(t).click()})),Object.entries(P).forEach(([s,[t,i]])=>e(document).on("blur.wa",`#${s}`,function(){const l=t(e(this).val());e(this).val(l);const m=i(l);m!==!0&&d(this,m,"error",2500)})),e(document).on("blur.wa","#regUsuario",async function(){const s=e(this).val().trim();if(s.includes("@"))return a=!1,d(this,"No puede contener @","error",2500);if(!(s.length<3))try{const t=(await E(b(f,p.db,s))).exists();a=!t,d(this,`Usuario ${t?"no disponible ❌":"disponible ✅"}`,t?"error":"success",3e3)}catch(t){console.error(t)}}),e(document).on("focus.wa","#email,#password",function(){d(this,e(this).attr("placeholder"))}),e(document).on("blur.wa","#regEmail",async function(){const s=e(this).val().trim();if(s.length>0&&!s.includes("@"))return o=!1,d(this,"Debe ser email válido","error",2500);if(!(s.length<3||!s.includes("@")))try{const t=!(await W(F(Q(f,p.db),X("email","==",s)))).empty;o=!t,d(this,`Email ${t?"no disponible ❌":"disponible ✅"}`,t?"error":"success",3e3)}catch(t){console.error(t)}}),e(document).on("click.wa","#Registrar",async function(){if(r)return;if(!e("#regTerminos").is(":checked"))return d(e("#regTerminos")[0],"Acepta los términos","error",2500);r=!0,g(this,!0,"Registrando");const t=[[a,e("#regUsuario")[0],"Usuario no disponible"],[o,e("#regEmail")[0],"Email no disponible"],...Object.entries(P).map(([i,[l,m]])=>{const y=m(l(e(`#${i}`).val()));return[y===!0,e(`#${i}`)[0],y!==!0?y:""]})].find(([i,,l])=>!i&&l);if(t){g(this,!1),d(t[1],t[2],"error",2500),t[1].focus(),r=!1;return}try{const i={email:u("regEmail"),usuario:u("regUsuario"),nombre:u("regNombre"),apellidos:u("regApellidos"),password:u("regPassword")},{user:l}=await Y(w,i.email,i.password);await Promise.all([Z(l,{displayName:i.usuario}),G(l)]);const m={usuario:i.usuario,email:i.email,nombre:i.nombre,apellidos:i.apellidos,rol:p.rol,uid:l.uid,terminos:!0,tema:localStorage.wiTema};await T(b(f,p.db,i.usuario),{...m,creado:R()}),await S(m)}catch(i){h(C[i.code]||i.message,"error")}finally{g(this,!1),r=!1}}),e(document).on("click.wa","#Login",async function(){g(this,!0,"Iniciando");try{await H(w,await M(u("email")),u("password"));const s=w.currentUser.displayName||u("email"),t=(await E(b(f,p.db,s))).data();t?.tema&&(localStorage.wiTema=t.tema,sa(t.tema)),await S(t,450)}catch(s){h(C[s.code]||s.message,"error")}finally{g(this,!1)}}),e(document).on("click.wa","#Recuperar",async function(){g(this,!0,"Enviando");try{await J(w,await M(u("recEmail"))),h("✅ Email enviado para restablecer","success")}catch(s){h(s.message||"Error al enviar","error")}finally{g(this,!1)}});const n={crearCuenta:["registroModal","loginModal"],conCuenta:["loginModal","registroModal"],olvidastePass:["recuperarModal","loginModal"],volverLogin:["loginModal","recuperarModal"]};e(document).on("click.wa",Object.keys(n).map(s=>"."+s).join(","),function(){const[s,t]=n[e(this).attr("class").split(" ")[0]];I(t),A(s)})};e(document).on("click.wa",".login,.registrar",function(a){a.preventDefault(),ea(),setTimeout(()=>A(e(this).hasClass("login")?"loginModal":"registroModal"),100)});e(document).on("click.wa",".tema",async function(){const a=localStorage.wiTema,o=O("wiSmile");if(o)try{await T(b(f,p.db,o.usuario),{tema:a,actualizado:R()},{merge:!0}),h(`Tema ${a.split("|")[0]} guardado ✅`)}catch(r){console.error(r)}});const U=Object.freeze(Object.defineProperty({__proto__:null,auth:w,onAuthStateChanged:B,signOut:K},Symbol.toStringTag,{value:"Module"}));let v=null;const L=async(...a)=>{if(v)return;const{auth:o,onAuthStateChanged:r}=await k(async()=>{const{auth:n,onAuthStateChanged:s}=await Promise.resolve().then(()=>U);return{auth:n,onAuthStateChanged:s}},void 0);v=r(o,async n=>{if(n)for(const s of a)try{await s(n)}catch(t){console.error(t)}else V("wiSmile"),x()})},oa=()=>{v?.(),v=null};function D(a){h?.("Bienvenido "+a.nombre),e(".wiauth").html(`
    <a href="/smile" class="nv_item" data-page="smile"><i class="fa-solid fa-gauge"></i> <span>Dashboard </span></a>
    <div class="sesion"><img src="${a.imagen||"./smile.avif"}" alt="${a.nombre}"><span>${a.nombre}</span></div>
    <button class="wibtn_auth bt_salir"><i class="fas fa-sign-out-alt"></i>Salir</button>
  `),z.navigate("/smile")}function x(){e(".wiauth").html(`
    <a href="/smile" class="nv_item" data-page="smile"><i class="fa-solid fa-gauge"></i> <span>Descubre </span></a>
    <button class="wibtn_auth registrar"><i class="fas fa-user-plus"></i><span>Registrar</span></button>
    <button class="wibtn_auth login"><i class="fas fa-sign-in-alt"></i><span>Login</span></button>
  `)}const j=O("wiSmile");j?(D(j),L()):x();e(document).on("click",".bt_salir",async()=>{const a=["wiflash","wiTema"].map(n=>[n,localStorage.getItem(n)]),{auth:o,signOut:r}=await k(async()=>{const{auth:n,signOut:s}=await Promise.resolve().then(()=>U);return{auth:n,signOut:s}},void 0);await r(o),localStorage.clear(),a.forEach(([n,s])=>s&&localStorage.setItem(n,s)),location.reload()});const ia=Object.freeze(Object.defineProperty({__proto__:null,personal:D,wiDesconectar:oa,wiObservar:L},Symbol.toStringTag,{value:"Module"}));export{D as personal,oa as wiDesconectar,L as wiObservar};
