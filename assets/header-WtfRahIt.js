import{_ as k}from"./main-B3qnf9q9.js";import{j as e}from"./vendor-gzd0YkcT.js";import{a as w,d as h}from"./firebase-CnlyPQ1R.js";import{o as D,s as A,d as b,a as O,g as E,b as N,q,c as z,w as V,e as B,u as W,f as F,h as Q,i as X,j as Y}from"./firebase-ozpKflHc.js";import{m as T,e as R,M as f,d,a as g,l as Z,s as G,o as H,r as J,q as K}from"./main-iOlbkp1v.js";const p={db:"smiles",rol:"smile"},C={"auth/email-already-in-use":"Email ya registrado","auth/weak-password":"Contraseña débil","auth/invalid-credential":"Contraseña incorrecta","auth/invalid-email":"Email no válido","auth/missing-email":"Usuario no registrado","auth/too-many-requests":"Demasiados intentos, espera"},P={regEmail:[a=>a.toLowerCase().trim(),a=>/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/.test(a)||"Email inválido"],regUsuario:[a=>a.toLowerCase().replace(/[^a-z0-9_]/g,"").trim(),a=>a.length>=4||"Usuario 4-20 caracteres"],regNombre:[a=>a.trim(),a=>a.length>0||"Ingrese nombre"],regApellidos:[a=>a.trim(),a=>a.length>0||"Ingrese apellidos"],regPassword:[a=>a,a=>a.length>=6||"Mínimo 6 caracteres"],regPassword1:[a=>a,a=>a===e("#regPassword").val()||"No coinciden"]},c=(a,o,i,n,s)=>`<div class="au_grupo"><i class="fas fa-${a}"></i><input type="${o}" id="${i}" placeholder="${n}" required>${s?'<i class="fas fa-eye au_ojo"></i>':""}</div>`,_=(a,o,i,n="")=>`<div id="${a}" class="wiModal au_mod ${n}"><div class="modalBody"><button class="modalX">&times;</button><div class="au_main"><div class="au_logo">
   <img src="./smile.avif"></div><h2>${o}</h2><form id="${a.replace("Modal","Form")}">${i}</form></div></div></div>`,aa=[_("loginModal","Login",[c("envelope","text","email","Email o usuario"),c("lock","password","password","Contraseña",!0),'<button type="button" id="Login" class="au_btn inactivo">Iniciar Sesión</button>','<div class="au_links"><span class="olvidastePass">¿Olvidaste tu contraseña?</span><span class="crearCuenta">Crear cuenta</span></div>'].join("")),_("registroModal","Crear Cuenta",[c("envelope","email","regEmail","Email"),c("user","text","regUsuario","Usuario"),c("user-tie","text","regNombre","Nombre"),c("user-tie","text","regApellidos","Apellidos"),c("lock","password","regPassword","Contraseña",!0),c("lock","password","regPassword1","Confirmar",!0),'<div class="au_grupo au_check"><label><input type="checkbox" id="regTerminos" required><span>Acepto los <a href="/terminos.html" target="_blank">términos y condiciones</a></span></label></div>','<button type="button" id="Registrar" class="au_btn inactivo">Registrarme</button>','<div class="au_links"><span class="conCuenta">Ya tengo cuenta</span></div>'].join(""),"au_reg"),_("recuperarModal","Restablecer",["<p>Ingresa tu Email o usuario:</p>",c("envelope","text","recEmail","Email o usuario"),'<button type="button" id="Recuperar" class="au_btn inactivo">Enviar enlace</button>','<div class="au_links"><span class="volverLogin"><i class="fas fa-arrow-left"></i> Volver</span></div>'].join(""))];let $=!1;const ea=()=>{$||(e("body").append(aa.join("")),$=!0,ta())},M=async a=>{if(a.includes("@"))return a;const o=await E(b(h,p.db,a));if(!o.exists())throw new Error("Usuario no encontrado");return o.data().email},sa=a=>{if(!a)return;const[o,i]=a.split("|");document.documentElement.dataset.theme=o,e('meta[name="theme-color"]').attr("content",i),e(".tema").removeClass("mtha").filter(`[data-ths="${a}"]`).addClass("mtha")},S=async(a,o=24)=>{G("wiSmile",a,o),H(),(await k(async()=>{const{personal:i}=await Promise.resolve().then(()=>ra);return{personal:i}},void 0)).personal(a)},u=a=>e(`#${a}`).val().trim(),ta=()=>{let a=!1,o=!1,i=!1;e(document).on("click.wa",".au_ojo",function(){const s=e(this).siblings("input");s.attr("type",s.attr("type")==="password"?"text":"password"),e(this).toggleClass("fa-eye fa-eye-slash")}),e(document).on("input.wa","#regUsuario,#regEmail,#email,#recEmail",function(){e(this).val(e(this).val().toLowerCase())}),[["#password","#Login"],["#regPassword1","#Registrar"],["#recEmail","#Recuperar"]].forEach(([s,t])=>e(document).on("input.wa keyup.wa",s,r=>{e(t).removeClass("inactivo"),r.key==="Enter"&&e(t).click()})),Object.entries(P).forEach(([s,[t,r]])=>e(document).on("blur.wa",`#${s}`,function(){const l=t(e(this).val());e(this).val(l);const m=r(l);m!==!0&&d(this,m,"error",2500)})),e(document).on("blur.wa","#regUsuario",async function(){const s=e(this).val().trim();if(s.includes("@"))return a=!1,d(this,"No puede contener @","error",2500);if(!(s.length<3))try{const t=(await E(b(h,p.db,s))).exists();a=!t,d(this,`Usuario ${t?"no disponible ❌":"disponible ✅"}`,t?"error":"success",3e3)}catch(t){console.error(t)}}),e(document).on("focus.wa","#email,#password",function(){d(this,e(this).attr("placeholder"))}),e(document).on("blur.wa","#regEmail",async function(){const s=e(this).val().trim();if(s.length>0&&!s.includes("@"))return o=!1,d(this,"Debe ser email válido","error",2500);if(!(s.length<3||!s.includes("@")))try{const t=!(await N(q(z(h,p.db),V("email","==",s)))).empty;o=!t,d(this,`Email ${t?"no disponible ❌":"disponible ✅"}`,t?"error":"success",3e3)}catch(t){console.error(t)}}),e(document).on("click.wa","#Registrar",async function(){if(i)return;if(!e("#regTerminos").is(":checked"))return d(e("#regTerminos")[0],"Acepta los términos","error",2500);i=!0,g(this,!0,"Registrando");const t=[[a,e("#regUsuario")[0],"Usuario no disponible"],[o,e("#regEmail")[0],"Email no disponible"],...Object.entries(P).map(([r,[l,m]])=>{const y=m(l(e(`#${r}`).val()));return[y===!0,e(`#${r}`)[0],y!==!0?y:""]})].find(([r,,l])=>!r&&l);if(t){g(this,!1),d(t[1],t[2],"error",2500),t[1].focus(),i=!1;return}try{const r={email:u("regEmail"),usuario:u("regUsuario"),nombre:u("regNombre"),apellidos:u("regApellidos"),password:u("regPassword")},{user:l}=await B(w,r.email,r.password);await Promise.all([W(l,{displayName:r.usuario}),F(l)]);const m={usuario:r.usuario,email:r.email,nombre:r.nombre,apellidos:r.apellidos,rol:p.rol,uid:l.uid,terminos:!0,tema:localStorage.wiTema};await A(b(h,p.db,r.usuario),{...m,creado:O()}),await S(m)}catch(r){f(C[r.code]||r.message,"error")}finally{g(this,!1),i=!1}}),e(document).on("click.wa","#Login",async function(){g(this,!0,"Iniciando");try{await Q(w,await M(u("email")),u("password"));const s=w.currentUser.displayName||u("email"),t=(await E(b(h,p.db,s))).data();t?.tema&&(localStorage.wiTema=t.tema,sa(t.tema)),await S(t,450)}catch(s){f(C[s.code]||s.message,"error")}finally{g(this,!1)}}),e(document).on("click.wa","#Recuperar",async function(){g(this,!0,"Enviando");try{await X(w,await M(u("recEmail"))),f("✅ Email enviado para restablecer","success")}catch(s){f(s.message||"Error al enviar","error")}finally{g(this,!1)}});const n={crearCuenta:["registroModal","loginModal"],conCuenta:["loginModal","registroModal"],olvidastePass:["recuperarModal","loginModal"],volverLogin:["loginModal","recuperarModal"]};e(document).on("click.wa",Object.keys(n).map(s=>"."+s).join(","),function(){const[s,t]=n[e(this).attr("class").split(" ")[0]];Z(t),T(s)})};e(document).on("click.wa",".login,.registrar",function(a){a.preventDefault(),ea(),setTimeout(()=>T(e(this).hasClass("login")?"loginModal":"registroModal"),100)});e(document).on("click.wa",".tema",async function(){const a=localStorage.wiTema,o=R("wiSmile");if(o)try{await A(b(h,p.db,o.usuario),{tema:a,actualizado:O()},{merge:!0}),f(`Tema ${a.split("|")[0]} guardado ✅`)}catch(i){console.error(i)}});const U=Object.freeze(Object.defineProperty({__proto__:null,auth:w,onAuthStateChanged:D,signOut:Y},Symbol.toStringTag,{value:"Module"}));let v=null;const L=async(...a)=>{if(v)return;const{auth:o,onAuthStateChanged:i}=await k(async()=>{const{auth:n,onAuthStateChanged:s}=await Promise.resolve().then(()=>U);return{auth:n,onAuthStateChanged:s}},void 0);v=i(o,async n=>{if(n)for(const s of a)try{await s(n)}catch(t){console.error(t)}else K("wiSmile"),I()})},oa=()=>{v?.(),v=null};function x(a){f?.("Bienvenido "+a.nombre),e(".wiauth").html(`
    <div class="sesion"><img src="${a.imagen||"./smile.avif"}" alt="${a.nombre}"><span>${a.nombre}</span></div>
    <button class="wibtn_auth bt_salir"><i class="fas fa-sign-out-alt"></i>Salir</button>
  `),J.navigate("/smile")}function I(){e(".wiauth").html(`
    <button class="wibtn_auth registrar"><i class="fas fa-user-plus"></i><span>Registrar</span></button>
    <button class="wibtn_auth login"><i class="fas fa-sign-in-alt"></i><span>Login</span></button>
  `)}const j=R("wiSmile");j?(x(j),L()):I();e(document).on("click",".bt_salir",async()=>{const a=["wiflash","wiTema"].map(n=>[n,localStorage.getItem(n)]),{auth:o,signOut:i}=await k(async()=>{const{auth:n,signOut:s}=await Promise.resolve().then(()=>U);return{auth:n,signOut:s}},void 0);await i(o),localStorage.clear(),a.forEach(([n,s])=>s&&localStorage.setItem(n,s)),location.reload()});const ra=Object.freeze(Object.defineProperty({__proto__:null,personal:x,wiDesconectar:oa,wiObservar:L},Symbol.toStringTag,{value:"Module"}));export{x as personal,oa as wiDesconectar,L as wiObservar};
