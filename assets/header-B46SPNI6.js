import{_ as k}from"./main-CWyf82FG.js";import{j as s}from"./vendor-gzd0YkcT.js";import{a as w,d as h}from"./firebase-DsW769jT.js";import{k as D,s as A,d as b,e as O,g as E,b as N,q,c as z,w as V,l as B,m as W,n as F,p as Q,r as X,t as Y}from"./firebase-B4Nf_p6C.js";import{q as T,g as R,M as f,j as m,e as g,o as Z,s as G,r as H,t as J,u as K}from"./main-DkHKdfdH.js";const p={db:"smiles",rol:"smile"},C={"auth/email-already-in-use":"Email ya registrado","auth/weak-password":"Contraseña débil","auth/invalid-credential":"Contraseña incorrecta","auth/invalid-email":"Email no válido","auth/missing-email":"Usuario no registrado","auth/too-many-requests":"Demasiados intentos, espera"},P={regEmail:[a=>a.toLowerCase().trim(),a=>/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/.test(a)||"Email inválido"],regUsuario:[a=>a.toLowerCase().replace(/[^a-z0-9_]/g,"").trim(),a=>a.length>=4||"Usuario 4-20 caracteres"],regNombre:[a=>a.trim(),a=>a.length>0||"Ingrese nombre"],regApellidos:[a=>a.trim(),a=>a.length>0||"Ingrese apellidos"],regPassword:[a=>a,a=>a.length>=6||"Mínimo 6 caracteres"],regPassword1:[a=>a,a=>a===s("#regPassword").val()||"No coinciden"]},c=(a,o,i,n,e)=>`<div class="au_grupo"><i class="fas fa-${a}"></i><input type="${o}" id="${i}" placeholder="${n}" required>${e?'<i class="fas fa-eye au_ojo"></i>':""}</div>`,_=(a,o,i,n="")=>`<div id="${a}" class="wiModal au_mod ${n}"><div class="modalBody"><button class="modalX">&times;</button><div class="au_main"><div class="au_logo">
   <img src="./smile.avif"></div><h2>${o}</h2><form id="${a.replace("Modal","Form")}">${i}</form></div></div></div>`,aa=[_("loginModal","Login",[c("envelope","text","email","Email o usuario"),c("lock","password","password","Contraseña",!0),'<button type="button" id="Login" class="au_btn inactivo">Iniciar Sesión</button>','<div class="au_links"><span class="olvidastePass">¿Olvidaste tu contraseña?</span><span class="crearCuenta">Crear cuenta</span></div>'].join("")),_("registroModal","Crear Cuenta",[c("envelope","email","regEmail","Email"),c("user","text","regUsuario","Usuario"),c("user-tie","text","regNombre","Nombre"),c("user-tie","text","regApellidos","Apellidos"),c("lock","password","regPassword","Contraseña",!0),c("lock","password","regPassword1","Confirmar",!0),'<div class="au_grupo au_check"><label><input type="checkbox" id="regTerminos" required><span>Acepto los <a href="/terminos.html" target="_blank">términos y condiciones</a></span></label></div>','<button type="button" id="Registrar" class="au_btn inactivo">Registrarme</button>','<div class="au_links"><span class="conCuenta">Ya tengo cuenta</span></div>'].join(""),"au_reg"),_("recuperarModal","Restablecer",["<p>Ingresa tu Email o usuario:</p>",c("envelope","text","recEmail","Email o usuario"),'<button type="button" id="Recuperar" class="au_btn inactivo">Enviar enlace</button>','<div class="au_links"><span class="volverLogin"><i class="fas fa-arrow-left"></i> Volver</span></div>'].join(""))];let $=!1;const ea=()=>{$||(s("body").append(aa.join("")),$=!0,ta())},M=async a=>{if(a.includes("@"))return a;const o=await E(b(h,p.db,a));if(!o.exists())throw new Error("Usuario no encontrado");return o.data().email},sa=a=>{if(!a)return;const[o,i]=a.split("|");document.documentElement.dataset.theme=o,s('meta[name="theme-color"]').attr("content",i),s(".tema").removeClass("mtha").filter(`[data-ths="${a}"]`).addClass("mtha")},S=async(a,o=24)=>{G("wiSmile",a,o),H(),(await k(async()=>{const{personal:i}=await Promise.resolve().then(()=>ra);return{personal:i}},void 0)).personal(a)},u=a=>s(`#${a}`).val().trim(),ta=()=>{let a=!1,o=!1,i=!1;s(document).on("click.wa",".au_ojo",function(){const e=s(this).siblings("input");e.attr("type",e.attr("type")==="password"?"text":"password"),s(this).toggleClass("fa-eye fa-eye-slash")}),s(document).on("input.wa","#regUsuario,#regEmail,#email,#recEmail",function(){s(this).val(s(this).val().toLowerCase())}),[["#password","#Login"],["#regPassword1","#Registrar"],["#recEmail","#Recuperar"]].forEach(([e,t])=>s(document).on("input.wa keyup.wa",e,r=>{s(t).removeClass("inactivo"),r.key==="Enter"&&s(t).click()})),Object.entries(P).forEach(([e,[t,r]])=>s(document).on("blur.wa",`#${e}`,function(){const l=t(s(this).val());s(this).val(l);const d=r(l);d!==!0&&m(this,d,"error",2500)})),s(document).on("blur.wa","#regUsuario",async function(){const e=s(this).val().trim();if(e.includes("@"))return a=!1,m(this,"No puede contener @","error",2500);if(!(e.length<3))try{const t=(await E(b(h,p.db,e))).exists();a=!t,m(this,`Usuario ${t?"no disponible ❌":"disponible ✅"}`,t?"error":"success",3e3)}catch(t){console.error(t)}}),s(document).on("blur.wa","#regEmail",async function(){const e=s(this).val().trim();if(e.length>0&&!e.includes("@"))return o=!1,m(this,"Debe ser email válido","error",2500);if(!(e.length<3||!e.includes("@")))try{const t=!(await N(q(z(h,p.db),V("email","==",e)))).empty;o=!t,m(this,`Email ${t?"no disponible ❌":"disponible ✅"}`,t?"error":"success",3e3)}catch(t){console.error(t)}}),s(document).on("click.wa","#Registrar",async function(){if(i)return;if(!s("#regTerminos").is(":checked"))return m(s("#regTerminos")[0],"Acepta los términos","error",2500);i=!0,g(this,!0,"Registrando");const t=[[a,s("#regUsuario")[0],"Usuario no disponible"],[o,s("#regEmail")[0],"Email no disponible"],...Object.entries(P).map(([r,[l,d]])=>{const y=d(l(s(`#${r}`).val()));return[y===!0,s(`#${r}`)[0],y!==!0?y:""]})].find(([r,,l])=>!r&&l);if(t){g(this,!1),m(t[1],t[2],"error",2500),t[1].focus(),i=!1;return}try{const r={email:u("regEmail"),usuario:u("regUsuario"),nombre:u("regNombre"),apellidos:u("regApellidos"),password:u("regPassword")},{user:l}=await B(w,r.email,r.password);await Promise.all([W(l,{displayName:r.usuario}),F(l)]);const d={usuario:r.usuario,email:r.email,nombre:r.nombre,apellidos:r.apellidos,rol:p.rol,uid:l.uid,terminos:!0,tema:localStorage.wiTema};await A(b(h,p.db,r.usuario),{...d,creado:O()}),await S(d)}catch(r){f(C[r.code]||r.message,"error")}finally{g(this,!1),i=!1}}),s(document).on("click.wa","#Login",async function(){g(this,!0,"Iniciando");try{await Q(w,await M(u("email")),u("password"));const e=w.currentUser.displayName||u("email"),t=(await E(b(h,p.db,e))).data();t?.tema&&(localStorage.wiTema=t.tema,sa(t.tema)),await S(t,450)}catch(e){f(C[e.code]||e.message,"error")}finally{g(this,!1)}}),s(document).on("click.wa","#Recuperar",async function(){g(this,!0,"Enviando");try{await X(w,await M(u("recEmail"))),f("✅ Email enviado para restablecer","success")}catch(e){f(e.message||"Error al enviar","error")}finally{g(this,!1)}});const n={crearCuenta:["registroModal","loginModal"],conCuenta:["loginModal","registroModal"],olvidastePass:["recuperarModal","loginModal"],volverLogin:["loginModal","recuperarModal"]};s(document).on("click.wa",Object.keys(n).map(e=>"."+e).join(","),function(){const[e,t]=n[s(this).attr("class").split(" ")[0]];Z(t),T(e)})};s(document).on("click.wa",".login,.registrar",function(a){a.preventDefault(),ea(),setTimeout(()=>T(s(this).hasClass("login")?"loginModal":"registroModal"),100)});s(document).on("click.wa",".tema",async function(){const a=localStorage.wiTema,o=R("wiSmile");if(o)try{await A(b(h,p.db,o.usuario),{tema:a,actualizado:O()},{merge:!0}),f(`Tema ${a.split("|")[0]} guardado ✅`)}catch(i){console.error(i)}});const U=Object.freeze(Object.defineProperty({__proto__:null,auth:w,onAuthStateChanged:D,signOut:Y},Symbol.toStringTag,{value:"Module"}));let v=null;const L=async(...a)=>{if(v)return;const{auth:o,onAuthStateChanged:i}=await k(async()=>{const{auth:n,onAuthStateChanged:e}=await Promise.resolve().then(()=>U);return{auth:n,onAuthStateChanged:e}},void 0);v=i(o,async n=>{if(n)for(const e of a)try{await e(n)}catch(t){console.error(t)}else K("wiSmile"),I()})},oa=()=>{v?.(),v=null};function x(a){f?.("Bienvenido "+a.nombre),s(".wiauth").html(`
    <div class="sesion"><img src="${a.imagen||"./smile.avif"}" alt="${a.nombre}"><span>${a.nombre}</span></div>
    <button class="wibtn_auth bt_salir"><i class="fas fa-sign-out-alt"></i><span>Salir</span></button>
  `),J.navigate("/smile")}function I(){s(".wiauth").html(`
    <button class="wibtn_auth registrar"><i class="fas fa-user-plus"></i><span>Registrar</span></button>
    <button class="wibtn_auth login"><i class="fas fa-sign-in-alt"></i><span>Login</span></button>
  `)}const j=R("wiSmile");j?(x(j),L()):I();s(document).on("click",".bt_salir",async()=>{const a=["wiflash","wiTema"].map(n=>[n,localStorage.getItem(n)]),{auth:o,signOut:i}=await k(async()=>{const{auth:n,signOut:e}=await Promise.resolve().then(()=>U);return{auth:n,signOut:e}},void 0);await i(o),localStorage.clear(),a.forEach(([n,e])=>e&&localStorage.setItem(n,e)),location.reload()});const ra=Object.freeze(Object.defineProperty({__proto__:null,personal:x,wiDesconectar:oa,wiObservar:L},Symbol.toStringTag,{value:"Module"}));export{x as personal,oa as wiDesconectar,L as wiObservar};
